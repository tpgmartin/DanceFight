<template name="videoPlayer">
  <div class="container">
    <div id="main" class="row-fluid">
      {{#each groups}}
        <div class="col-sm-6">
          <iframe id="player{{id}}" class="video" type="text/html" width="100%" height="360" src="{{url}}" frameborder="0"></iframe>
          <button class="vote" id="{{id}}">Vote for {{title}}</button >
        </div>
      {{/each}}

      <div id="loading">
      </div>

      <button id="play"></button>
      <button id="pause"></button>
      <script>
      // YouTube API
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player1;
      var player2;

      function onYouTubeIframeAPIReady() {
          player1 = new YT.Player('player1', {
              events: {
                'onReady': onPlayer1Ready,
                'onStateChange': onPlayer1StateChange
              }
          });
          player2 = new YT.Player('player2', {
              events: {
                'onReady': onPlayer2Ready,
                'onStateChange': onPlayer2StateChange
              }
          });
      }

      var player1Ready = false;
      var player2Ready = false;
      var preloading1 = false;
      var preloading2 = false;

      function onPlayer1Ready(event) {
          player1Ready = true;

      }

      function onPlayer2Ready(event) {
          player2Ready = true;
      }

      function onPlayer1StateChange(event) {
          if (event.data == YT.PlayerState.PLAYING) {
              if (preloading1) {
                  // player1.pauseVideo();
                  player1.seekTo(0);
                  player1.unMute();
                  preloading1 = false;
              } else player2.playVideo();
          } else if (event.data == YT.PlayerState.PAUSED) {
              if (!preloading1) player2.pauseVideo();
          } else if (event.data == YT.PlayerState.BUFFERING) {
              if (!preloading1) {
                  player2.pauseVideo();
              }

          } else if (event.data == YT.PlayerState.CUED) {
              if (!preloading1) player2.pauseVideo();

          } else if (event.data == YT.PlayerState.ENDED) {
              player2.stopVideo();

          }

      }

      function onPlayer2StateChange(event) {
          if (event.data == YT.PlayerState.PLAYING) {
              if (preloading2) {
                  // player2.pauseVideo();
                  player2.seekTo(0);
                  player2.unMute();
                  preloading2 = false;
              } else player1.playVideo();
          } else if (event.data == YT.PlayerState.PAUSED) {
              if (!preloading2) player1.pauseVideo();
          } else if (event.data == YT.PlayerState.BUFFERING) {
              if (!preloading2) {
                  player1.pauseVideo();
              }

          } else if (event.data == YT.PlayerState.CUED) {
              if (!preloading2) player1.pauseVideo();

          } else if (event.data == YT.PlayerState.ENDED) {
              player1.stopVideo();

          }

      }
      </script>
    </div>
  </div>
</template>